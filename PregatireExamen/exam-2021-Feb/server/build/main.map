{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.js","webpack:///external \"@koa/cors\"","webpack:///external \"http\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-router\"","webpack:///external \"ws\""],"names":["koa","require","app","module","exports","server","createServer","callback","WebSocket","wss","Server","Router","cors","bodyParser","use","middleware","ctx","next","start","Date","then","ms","console","log","toLocaleTimeString","request","method","url","response","status","getRandomInt","min","max","Math","ceil","floor","random","names","statuses","drivers","colors","vehicles","i","push","id","license","length","seats","driver","color","cargo","router","get","body","Set","map","obj","headers","params","filter","text","name","broadcast","data","clients","forEach","client","readyState","OPEN","send","JSON","stringify","post","index","findIndex","maxId","apply","del","splice","routes","allowedMethods","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","var koa = require('koa');\r\nvar app = module.exports = new koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({server});\r\nconst Router = require('koa-router');\r\nconst cors = require('@koa/cors');\r\nconst bodyParser = require('koa-bodyparser');\r\n\r\napp.use(bodyParser());\r\n\r\napp.use(cors());\r\n\r\napp.use(middleware);\r\n\r\nfunction middleware(ctx, next) {\r\n  const start = new Date();\r\n  return next().then(() => {\r\n    const ms = new Date() - start;\r\n    console.log(`${start.toLocaleTimeString()} ${ctx.request.method} ${ctx.request.url} ${ctx.response.status} - ${ms}ms`);\r\n  });\r\n}\r\n\r\n\r\nconst getRandomInt = (min, max) => {\r\n  min = Math.ceil(min);\r\n  max = Math.floor(max);\r\n  return Math.floor(Math.random() * (max - min)) + min;\r\n};\r\n\r\nconst names = ['IMGROOT',\r\n  'HAVA PUG',\r\n  'Y U CRYN',\r\n  'BOY',\r\n  'EXPIRED',\r\n  'GO FOXES',\r\n  'LLWLWWW'];\r\nconst statuses = ['new', 'working', 'damaged', 'old'];\r\nconst drivers = ['Michael', 'Matthew', 'Mason', 'Maverick', 'Miles', 'Maxwell', 'Max'];\r\nconst colors = ['Yellow', 'Blue', 'Black', 'Green', 'White', 'Red'];\r\nconst vehicles = [];\r\n\r\nfor (let i = 0; i < 50; i++) {\r\n  vehicles.push({\r\n    id: i + 1,\r\n    license: names[getRandomInt(0, names.length)] + \" \" + i,\r\n    status: statuses[getRandomInt(0, statuses.length)],\r\n    seats: getRandomInt(2, 20),\r\n    driver: drivers[getRandomInt(0, drivers.length)],\r\n    color: colors[getRandomInt(0, colors.length)],\r\n    cargo: getRandomInt(0, 400)\r\n  });\r\n}\r\n\r\nconst router = new Router();\r\n\r\nrouter.get('/all', ctx => {\r\n  ctx.response.body = vehicles;\r\n  ctx.response.status = 200;\r\n});\r\n\r\nrouter.get('/review', ctx => {\r\n  ctx.response.body = vehicles;\r\n  ctx.response.status = 200;\r\n});\r\n\r\n\r\nrouter.get('/colors', ctx => {\r\n  ctx.response.body = [...new Set(vehicles.map(obj => obj.color))];\r\n  ctx.response.status = 200;\r\n});\r\n\r\nrouter.get('/vehicles/:color', ctx => {\r\n  const headers = ctx.params;\r\n  const color = headers.color;\r\n  if (typeof color !== 'undefined') {\r\n    ctx.response.body = vehicles.filter(obj => obj.color == color);\r\n    ctx.response.status = 200;\r\n  } else {\r\n    console.log(\"Missing or invalid: color!\");\r\n    ctx.response.body = {text: 'Missing or invalid: color!'};\r\n    ctx.response.status = 404;\r\n  }\r\n});\r\n\r\nrouter.get('/driver/:name', ctx => {\r\n  const headers = ctx.params;\r\n  const name = headers.name;\r\n  if (typeof name !== 'undefined') {\r\n    ctx.response.body = vehicles.filter(obj => obj.driver == name);\r\n    ctx.response.status = 200;\r\n  } else {\r\n    console.log(\"Missing or invalid: driver name!\");\r\n    ctx.response.body = {text: 'Missing or invalid: driver name!'};\r\n    ctx.response.status = 404;\r\n  }\r\n});\r\n\r\n\r\nconst broadcast = (data) =>\r\n  wss.clients.forEach((client) => {\r\n    if (client.readyState === WebSocket.OPEN) {\r\n      client.send(JSON.stringify(data));\r\n    }\r\n  });\r\n\r\nrouter.post('/vehicle', ctx => {\r\n  // console.log(\"ctx: \" + JSON.stringify(ctx));\r\n  const headers = ctx.request.body;\r\n  // console.log(\"body: \" + JSON.stringify(headers));\r\n  const license = headers.license;\r\n  const seats = headers.seats;\r\n  const driver = headers.driver;\r\n  const color = headers.color;\r\n  const cargo = headers.cargo;\r\n  if (typeof license !== 'undefined' && typeof driver !== 'undefined' && typeof seats !== 'undefined'\r\n    && color !== 'undefined' && cargo !== 'undefined') {\r\n    const index = vehicles.findIndex(obj => obj.license == license);\r\n    if (index !== -1) {\r\n      console.log(\"Vehicle already exists!\");\r\n      ctx.response.body = {text: 'Vehicle already exists!'};\r\n      ctx.response.status = 404;\r\n    } else {\r\n      let maxId = Math.max.apply(Math, vehicles.map(function (obj) {\r\n        return obj.id;\r\n      })) + 1;\r\n      let obj = {\r\n        id: maxId,\r\n        license,\r\n        status: 'new',\r\n        seats,\r\n        driver,\r\n        color,\r\n        cargo\r\n      };\r\n      // console.log(\"created: \" + JSON.stringify(license));\r\n      vehicles.push(obj);\r\n      broadcast(obj);\r\n      ctx.response.body = obj;\r\n      ctx.response.status = 200;\r\n    }\r\n  } else {\r\n    console.log(\"Missing or invalid fields!\");\r\n    ctx.response.body = {text: 'Missing or invalid fields!'};\r\n    ctx.response.status = 404;\r\n  }\r\n});\r\n\r\nrouter.del('/vehicle/:id', ctx => {\r\n  // console.log(\"ctx: \" + JSON.stringify(ctx));\r\n  const headers = ctx.params;\r\n  // console.log(\"body: \" + JSON.stringify(headers));\r\n  const id = headers.id;\r\n  if (typeof id !== 'undefined') {\r\n    const index = vehicles.findIndex(obj => obj.id == id);\r\n    if (index === -1) {\r\n      console.log(\"No vehicle with id: \" + id);\r\n      ctx.response.body = {text: 'Invalid vehicle id'};\r\n      ctx.response.status = 404;\r\n    } else {\r\n      let obj = vehicles[index];\r\n      // console.log(\"deleting: \" + JSON.stringify(obj));\r\n      vehicles.splice(index, 1);\r\n      ctx.response.body = obj;\r\n      ctx.response.status = 200;\r\n    }\r\n  } else {\r\n    console.log(\"Missing or invalid fields!\");\r\n    ctx.response.body = {text: 'Id missing or invalid'};\r\n    ctx.response.status = 404;\r\n  }\r\n});\r\n\r\napp.use(router.routes());\r\napp.use(router.allowedMethods());\r\n\r\nserver.listen(2021);\r\n","module.exports = require(\"@koa/cors\");","module.exports = require(\"http\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-router\");","module.exports = require(\"ws\");"],"sourceRoot":""}